<?xml version="1.0" encoding="UTF-8"?>
<!--
    $Id$
-->
<project name="plugin"
         xmlns:ivy="antlib:org.apache.ivy.ant"
         xmlns:opendds="antlib:org.opendds.ant">

    <import file="build-common.xml"/>

    <!--
        Plugin Properties
    -->
    <property name="eclipse.home" value="${env.ECLIPSE_HOME}"/>
    <property name="eclipse.plugins.dir" value="${eclipse.home}/plugins"/>

    <property name="eclipse.alt.home" value="${env.ECLIPSE_ALT_HOME}"/>
    <property name="eclipse.alt.plugins.dir" value="${eclipse.alt.home}/plugins"/>

    <property name="install.dir" value="${eclipse.plugins.dir}"/>

    <!--
        Plugin Targets
    -->
    <target name="resolve" depends="bootstrap" unless="plugin.resolve">
        <ivy:resolve conf="default" log="quiet"/>

        <!-- Setup project classpath -->
        <ivy:cachepath pathid="cache.classpath"/>

        <path id="project.classpath">
            <fileset dir="${project.lib.dir}">
                <include name="*.jar"/>
            </fileset>
            <path refid="cache.classpath"/>
            <fileset dir="${eclipse.plugins.dir}">
                <include name="*.jar"/>
            </fileset>
            <fileset dir="${eclipse.alt.plugins.dir}">
                <include name="*.jar"/>
            </fileset>
        </path>

        <!-- Initialize OpenDDS tasks -->
        <taskdef uri="antlib:org.opendds.ant"
                 resource="org/opendds/ant/antlib.xml"
                 classpathref="project.classpath"/>

        <opendds:init environment="env"/>

        <!-- Prevent spurious re-initialization -->
        <property name="plugin.resolve" value="true"/>
    </target>

    <target name="retrieve" depends="bootstrap" if="lib.dir">
        <ivy:resolve conf="thirdparty"/>

        <ivy:retrieve pattern="${lib.dir}/[artifact]-[revision].[ext]"
                      conf="thirdparty"/>
    </target>

    <target name="clean"/>
    <target name="build"/>
    <target name="test"/>
    <target name="archive"/>

    <target name="install" depends="archive"
    	    description="Install plugin artifacts">
        <mkdir dir="${install.dir}"/>
        <copy todir="${install.dir}">
            <fileset dir="${build.dir}">
              <include name="${plugin.artifact}"/>
            </fileset>
            <globmapper from="*.jar" to="*_${opendds.version}.jar"/>
        </copy>
    </target>
</project>
